<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ForgetfulMe - Bookmark Manager</title>
    <link rel="stylesheet" href="../lib/pico.min.css" />
    <link rel="stylesheet" href="../lib/gridjs-theme.min.css" />
    <link rel="stylesheet" href="styles/shared.css" />
    <link rel="stylesheet" href="styles/bookmark-manager.css" />
  </head>
  <body>
    <div class="container-fluid" data-testid="bookmark-manager-container">
      <header class="manager-header">
        <div class="header-content">
          <h1>Bookmark Manager</h1>
          <div class="header-stats">
            <span id="bookmark-count" class="bookmark-count" data-testid="bookmark-count"
              >0 bookmarks</span
            >
            <span id="user-info" class="user-info" data-testid="user-info"></span>
          </div>
        </div>
        <div class="header-actions">
          <button
            type="button"
            id="refresh-bookmarks"
            class="secondary outline"
            data-testid="refresh-bookmarks"
          >
            Refresh
          </button>
          <button type="button" id="open-options" class="secondary" data-testid="open-options">
            Settings
          </button>
        </div>
      </header>

      <!-- Simplified Filters -->
      <section class="filters-section" data-testid="filters-section">
        <div class="filters-grid">
          <label for="status-filter">
            Filter by Status:
            <select id="status-filter" name="statusFilter" data-testid="status-filter">
              <option value="">All Statuses</option>
              <!-- Options populated by JavaScript -->
            </select>
          </label>

          <label for="tag-filter">
            Filter by Tags:
            <input
              type="text"
              id="tag-filter"
              name="tagFilter"
              placeholder="e.g. web, docs"
              data-testid="tag-filter"
            />
          </label>

          <div class="filter-actions">
            <button type="button" id="apply-filters" class="secondary" data-testid="apply-filters">
              Apply Filters
            </button>
            <button
              type="button"
              id="clear-filters"
              class="secondary outline"
              data-testid="clear-filters"
            >
              Clear
            </button>
          </div>
        </div>
      </section>

      <!-- Toolbar -->
      <section class="toolbar" data-testid="toolbar">
        <div class="toolbar-left">
          <span id="selected-count" class="selected-count hidden" data-testid="selected-count"
            >0 selected</span
          >
        </div>

        <div class="toolbar-right">
          <div class="bulk-actions hidden" id="bulk-actions" data-testid="bulk-actions">
            <select id="bulk-status-update" data-testid="bulk-status-update">
              <option value="">Change Status...</option>
              <!-- Options populated by JavaScript -->
            </select>
            <button
              type="button"
              id="bulk-delete"
              class="secondary outline"
              data-testid="bulk-delete"
            >
              Delete Selected
            </button>
          </div>
        </div>
      </section>

      <!-- Bookmark Grid -->
      <main class="bookmark-list-container" data-testid="bookmark-list-container">
        <div id="bookmark-grid" class="bookmark-grid" data-testid="bookmark-grid">
          <!-- Grid.js table will be rendered here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="empty-state hidden" data-testid="empty-state">
          <h3>No bookmarks found</h3>
          <p>Start bookmarking pages to see them here.</p>
          <button type="button" id="clear-filters" class="secondary" data-testid="clear-filters">
            Clear Filters
          </button>
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="loading-state" data-testid="loading-state">
          <div class="loading-spinner"></div>
          <p>Loading bookmarks...</p>
        </div>
      </main>

      <!-- Messages -->
      <div id="message-area" class="message-area" data-testid="message-area"></div>
    </div>

    <!-- Edit Bookmark Modal -->
    <dialog id="edit-modal" class="edit-modal" data-testid="edit-modal">
      <article>
        <header>
          <h3>Edit Bookmark</h3>
          <button
            type="button"
            id="close-modal"
            class="close-button"
            aria-label="Close"
            data-testid="close-modal"
          >
            &times;
          </button>
        </header>

        <form id="edit-form" class="edit-form" data-testid="edit-form">
          <input type="hidden" id="edit-bookmark-id" name="id" />

          <!-- Form-wide error display -->
          <div
            id="edit-form-errors"
            class="form-errors hidden"
            data-testid="edit-form-errors"
          ></div>

          <fieldset>
            <label for="edit-title">
              Title
              <input
                type="text"
                id="edit-title"
                name="title"
                data-testid="edit-title"
                aria-describedby="edit-title-error"
              />
              <div
                id="edit-title-error"
                class="field-error hidden"
                data-testid="edit-title-error"
              ></div>
            </label>

            <label for="edit-url">
              URL
              <input
                type="url"
                id="edit-url"
                name="url"
                required
                data-testid="edit-url"
                aria-describedby="edit-url-error"
              />
              <div
                id="edit-url-error"
                class="field-error hidden"
                data-testid="edit-url-error"
              ></div>
            </label>

            <label for="edit-status">
              Status
              <select
                id="edit-status"
                name="status"
                required
                data-testid="edit-status"
                aria-describedby="edit-status-error"
              >
                <!-- Options populated by JavaScript -->
              </select>
              <div
                id="edit-status-error"
                class="field-error hidden"
                data-testid="edit-status-error"
              ></div>
            </label>

            <label for="edit-tags">
              Tags
              <input
                type="text"
                id="edit-tags"
                name="tags"
                placeholder="Separate with commas"
                data-testid="edit-tags"
                aria-describedby="edit-tags-error edit-tags-help"
              />
              <small id="edit-tags-help">Separate multiple tags with commas</small>
              <div
                id="edit-tags-error"
                class="field-error hidden"
                data-testid="edit-tags-error"
              ></div>
            </label>

            <label for="edit-notes">
              Notes
              <textarea
                id="edit-notes"
                name="notes"
                rows="4"
                data-testid="edit-notes"
                aria-describedby="edit-notes-error"
              ></textarea>
              <div
                id="edit-notes-error"
                class="field-error hidden"
                data-testid="edit-notes-error"
              ></div>
            </label>
          </fieldset>

          <footer class="modal-actions">
            <button
              type="button"
              id="cancel-edit"
              class="secondary outline"
              data-testid="cancel-edit"
            >
              Cancel
            </button>
            <button type="submit" id="save-edit" data-testid="save-edit">Save Changes</button>
          </footer>
        </form>
      </article>
    </dialog>

    <!-- Confirm Delete Modal -->
    <dialog id="delete-modal" class="delete-modal" data-testid="delete-modal">
      <article>
        <header>
          <h3>Confirm Delete</h3>
        </header>

        <p id="delete-message" data-testid="delete-message">
          Are you sure you want to delete this bookmark?
        </p>

        <footer class="modal-actions">
          <button
            type="button"
            id="cancel-delete"
            class="secondary outline"
            data-testid="cancel-delete"
          >
            Cancel
          </button>
          <button type="button" id="confirm-delete" class="contrast" data-testid="confirm-delete">
            Delete
          </button>
        </footer>
      </article>
    </dialog>

    <script src="../lib/supabase-js.min.js"></script>
    <script src="../lib/gridjs.umd.js"></script>
    <script type="module" src="../main/bookmark-manager.js"></script>
  </body>
</html>
